import{_ as ge}from"./Search.b0b724eb.js";import{_ as ke}from"./Delete.883e772e.js";import{u as Se,_ as Ie,a as Ce,b as De,c as Ne}from"./ToolsPopup.da24a0ac.js";import{_ as Ae}from"./Times.81d9e1a0.js";import{_ as $e}from"./InputPointFormat.vue.85473f7f.js";import{_ as je}from"./Plus.803b538c.js";import{n as Me,u as Te,q as Y,r as v,s as Be,v as Oe,x as qe,y as Re,C as T,D as H,Q as X,R as We,o as i,c as u,a as e,B as t,t as f,O as p,z as W,H as Pe,K as I,b as h,A as G,I as P,J as Ve,N as Z,S as ee,E as Ee}from"./entry.0b1d38b1.js";import{u as te}from"./useMyFetch.6a55485b.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.f18aaec2.js";import"./useUtils.100f5b4a.js";const Ue={class:"w-full h-full flex flex-col border-t-4 border-slate-600"},ze={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Fe={class:"w-full flex flex-col items-center justify-center grow overflow-auto"},Je={class:"w-full flex flex-row flex-wrap"},Ke={key:0,class:"w-full sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Le=e("label",{for:""},"Input At",-1),Qe={class:"card-border"},Ye={class:"w-full flex flex-col flex-wrap p-1 sm:w-4/12 md:w-3/12 lg:w-2/12"},He=e("label",{for:""},"Type",-1),Xe=["disabled"],Ge=e("option",{value:"used"},"Used",-1),Ze=e("option",{value:"in"},"In",-1),et=e("option",{value:"transfer"},"Transfer",-1),tt=[Ge,Ze,et],st={class:"text-red-500"},lt={class:"w-full sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ot=e("label",{for:""},"From Warehouse",-1),at={key:0,class:"w-full flex"},nt=e("div",{class:"flex items-center grow p-1"}," Pilih Warehouse yang dikelola ",-1),it={key:1,class:"w-full flex",style:{}},ut={class:"flex flex-row flex-wrap grow"},ct={class:"p-1"},dt=e("div",{class:"text-sm text-gray-600"},"ID",-1),rt={class:"bold"},_t={class:"p-1"},ft=e("div",{class:"text-sm text-gray-600"},"Name",-1),pt={class:"bold"},mt={class:"flex flex-row flex-wrap grow"},vt={class:"p-1"},ht=e("div",{class:"text-sm text-gray-600"},"ID",-1),wt={class:"bold"},xt={class:"p-1"},yt=e("div",{class:"text-sm text-gray-600"},"Name",-1),bt={class:"bold"},gt={class:"text-red-500"},kt={key:1,class:"w-full sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},St=e("label",{for:""},"To Warehouse",-1),It={key:0,class:"w-full flex"},Ct=e("div",{class:"flex items-center grow p-1"}," Pilih Warehouse Target ",-1),Dt={key:1,class:"w-full flex",style:{}},Nt={class:"flex flex-row flex-wrap grow"},At={class:"p-1"},$t=e("div",{class:"text-sm text-gray-600"},"ID",-1),jt={class:"bold"},Mt={class:"p-1"},Tt=e("div",{class:"text-sm text-gray-600"},"Name",-1),Bt={class:"bold"},Ot={class:"text-red-500"},qt={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},Rt=e("label",{for:""},"Note",-1),Wt=["disabled"],Pt={class:"text-red-500"},Vt={class:"w-full flex grow p-1 overflow-auto"},Et={role:"sticky",ref:"loadRef"},Ut={class:"tacky w-full",style:{"white-space":"normal"}},zt={class:"sticky top-0 !z-[2]"},Ft={key:0,class:"min-w-[50px] !w-[50px] max-w-[50px]"},Jt=e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),Kt={key:1,class:"min-w-[50px] !w-[50px] max-w-[50px]"},Lt=e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID Item",-1),Qt=e("th",null,"Nama Item",-1),Yt=e("th",{class:"min-w-[80px] !w-[80px] max-w-[80px]"},"Qty In",-1),Ht=e("th",{class:"min-w-[80px] !w-[80px] max-w-[80px]"},"Qty Out",-1),Xt=e("th",null,"Keterangan",-1),Gt=["data-index","onDragstart","onDrop"],Zt={key:0,class:"tools cell"},es={class:"w-full h-full flex items-center justify-center"},ts=["onClick"],ss={key:1,class:"cell"},ls={class:"w-full h-full flex items-center justify-center"},os=["onClick"],as=["onClick","disabled"],ns={class:"w-full h-full flex items-center justify-center"},is={class:"w-full h-full flex items-center justify-center"},us={class:"cell"},cs={class:"w-full h-full flex items-center justify-center"},ds={class:"cell"},rs={class:"w-full h-full flex items-center justify-center"},_s={class:"cell"},fs={class:"w-full h-full flex items-center justify-center"},ps=["disabled","onUpdate:modelValue","tabindex"],ms={key:0},vs={class:"tools cell"},hs={class:"w-full flex items-center justify-end"},As=Me({__name:"form",props:{id:{type:Number,required:!1}},async setup(se){var K,L,Q;let C,V;const E=se;Te();const U=Y("token"),y=v({});Be(),Oe();let D={id:"",name:""};const{data:B}=([C,V]=qe(async()=>Re(async()=>{const l=E.id;let s=null,d=null,m=null;if(l!=null&&l!==""){T().loading_full=!0;const{data:g,error:S,status:M}=await te("/api/transaction",{method:"get",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},params:{id:l},retry:0});T().loading_full=!1,M.value==="error"?H().trigger(S,y):(s=g.value.data,m=g.value.data.details.map(x=>(x.status="Edit",x.key=x.ordinal,x)),d=g.value.data.details.map(x=>x.item.id))}return{transaction:s,exclude_lists:d,details:m}},"$uMprYOKBrF")),C=await C,V(),C),o=v(((K=B.value)==null?void 0:K.transaction)||{id:-1,type:"used",note:"",warehouse:{...D},warehouse_target:{...D},details:[]}),b=v(((L=B.value)==null?void 0:L.exclude_lists)||[]),a=v(((Q=B.value)==null?void 0:Q.details)||[]),N=Y("locs");N.value&&N.value.length==1&&(o.value.warehouse={id:N.value[0].id,name:N.value[0].lokasi});const O=v({ordinal:0,item:{id:"",name:"",unit:{id:"",name:""}},item_id:"",qty_in:0,qty_out:0,note:"",status:""}),k=v(!1),le=()=>{k.value=!1},oe=l=>{a.value[r.value].item=l,a.value[r.value].item_id=l.id,b.value.push(l.id),k.value=!1},ae=l=>{l.forEach(s=>{let d={...O.value,status:"Add"};d.item=s,d.item_id=s.id,b.value.push(s.id),a.value.push(d)}),k.value=!1},q=v(!1),ne=(l,s)=>{r.value=s,q.value=!1,k.value=!0},ie=(l,s)=>{q.value=!0,k.value=!0},ue=(l,s)=>{let d=a.value[s].item.id,m=b.value.indexOf(d);m>-1&&b.value.splice(m,1),a.value[s].item_id="",a.value[s].item={id:"",name:"",unit:{id:"",name:""}}};let A=v(!1),$="";const R=l=>{l=="from"?o.value.warehouse={...D}:l=="to"&&(o.value.warehouse_target={...D})},z=l=>{$=l,A.value=!0},ce=()=>{A.value=!1},de=l=>{$=="from"?o.value.warehouse={...l}:$=="to"&&(o.value.warehouse_target={...l}),A.value=!1},re=async()=>{T().loading_full=!0,y.value={};let l={type:o.value.type,note:o.value.note,warehouse_id:o.value.warehouse.id,warehouse_target_id:o.value.warehouse_target.id,details:JSON.stringify(a.value)},s="post",d=E.id;d==null||(s="post",l.id=d,l._method="PUT");const{data:m,error:g,status:S}=await te("/api/transaction",{method:s,headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},body:l,retry:0});if(T().loading_full=!1,S.value==="error"){H().trigger(g,y);return}Ee().display({show:!0,status:"Success",message:"Data Tersimpan"})},_e=X(()=>{var l,s;return((l=o.value.warehouse)==null?void 0:l.id)||((s=o.value.warehouse_target)==null?void 0:s.id)||0}),r=v(-1),j=v(!1),F=v({left:0,top:0}),fe=(l,s)=>{r.value=s,j.value=!0,F.value={left:l.clientX,top:l.clientY}},pe=()=>{a.value.push({...O.value,status:"Add"})},me=()=>{j.value=!1},ve=(l="")=>{if(l=="insert")a.value.splice(r.value,0,{...O.value,status:"Add"});else if(l=="delete"){let s=a.value[r.value].item.id,d=b.value.indexOf(s);d>-1&&b.value.splice(d,1),a.value[r.value].status=="Edit"?a.value[r.value].status="Remove":a.value.splice(r.value,1)}else if(l=="move_top"){let s=a.value[r.value];a.value.splice(r.value,1),a.value.splice(r.value-1,0,{...s})}else if(l=="move_bottom"){let s=a.value[r.value];a.value.splice(r.value,1),a.value.splice(r.value+1,0,{...s})}j.value=!1},c=X(()=>o.value.confirmed_by||o.value.ref_id!=null),he=(l,s)=>{l.dataTransfer.setData("application/json",JSON.stringify(s))},we=(l,s)=>{let d=JSON.parse(l.dataTransfer.getData("application/json")),m=a.value[d];a.value.splice(d,1),a.value.splice(s,0,{...m})},J=v(null);return We(()=>{c.value||Se(J,a)}),(l,s)=>{const d=ge,m=ke,g=Ie,S=Ae,M=$e,x=je,xe=Ce,ye=De,be=Ne;return i(),u(P,null,[e("div",Ue,[e("form",ze,[e("div",Fe,[e("div",Je,[t(o).confirmed_by?(i(),u("div",Ke,[Le,e("div",Qe,f(l.$moment(t(o).input_at).format("DD-MM-Y")),1)])):p("",!0),e("div",Ye,[He,W(e("select",{disabled:t(c),class:"","onUpdate:modelValue":s[0]||(s[0]=n=>t(o).type=n)},tt,8,Xe),[[Pe,t(o).type]]),e("p",st,f(t(y).type),1)]),e("div",lt,[ot,e("div",{class:I(["w-full flex flex-row flex-wrap",t(c)?"unselectable":""])},[!t(o).warehouse||!t(o).warehouse.id?(i(),u("div",at,[e("button",{type:"button",onClick:s[1]||(s[1]=n=>z("from")),class:"flex items-center grow"},[h(d,{class:"text-2xl text-black"}),nt])])):t(o).ref_id==null?(i(),u("div",it,[e("div",ut,[e("div",ct,[dt,e("div",rt,f(t(o).warehouse.id),1)]),e("div",_t,[ft,e("div",pt,f(t(o).warehouse.name),1)])]),t(c)?p("",!0):(i(),u("button",{key:0,type:"button",class:"w-10 bg-red-600 flex items-center justify-center",onClick:s[2]||(s[2]=n=>R("from"))},[h(m,{class:"text-2xl text-white"})]))])):t(o).ref_id!=null?(i(),u("div",{key:2,class:I(["w-full flex",t(c)?"unselectable":""]),style:{}},[e("div",mt,[e("div",vt,[ht,e("div",wt,f(t(o).warehouse_source.id),1)]),e("div",xt,[yt,e("div",bt,f(t(o).warehouse_source.name),1)])]),t(c)?p("",!0):(i(),u("button",{key:0,type:"button",class:"w-10 bg-red-600 flex items-center justify-center",onClick:s[3]||(s[3]=n=>R("from"))},[h(m,{class:"text-2xl text-white"})]))],2)):p("",!0)],2),e("p",gt,f(t(y).warehouse_id),1)]),t(o).type=="transfer"?(i(),u("div",kt,[St,e("div",{class:I(["w-full flex flex-row flex-wrap",t(c)?"unselectable":""])},[!t(o).warehouse_target||!t(o).warehouse_target.id?(i(),u("div",It,[e("button",{type:"button",onClick:s[4]||(s[4]=n=>z("to")),class:"flex items-center grow"},[h(d,{class:"text-2xl text-black"}),Ct])])):(i(),u("div",Dt,[e("div",Nt,[e("div",At,[$t,e("div",jt,f(t(o).warehouse_target.id),1)]),e("div",Mt,[Tt,e("div",Bt,f(t(o).warehouse_target.name),1)])]),t(c)?p("",!0):(i(),u("button",{key:0,type:"button",class:"w-10 bg-red-600 flex items-center justify-center",onClick:s[5]||(s[5]=n=>R("to"))},[h(m,{class:"text-2xl text-white"})]))]))],2),e("p",Ot,f(t(y).warehouse_target_id),1)])):p("",!0),e("div",qt,[Rt,W(e("textarea",{disabled:t(c),class:"","onUpdate:modelValue":s[6]||(s[6]=n=>t(o).note=n)},null,8,Wt),[[G,t(o).note]]),e("p",Pt,f(t(y).note),1)])]),e("div",Vt,[e("div",Et,[e("table",Ut,[e("thead",null,[e("tr",zt,[t(c)?p("",!0):(i(),u("th",Ft,[e("button",{type:"button",name:"button",class:"bg-yellow-600",onClick:s[7]||(s[7]=n=>ie())}," Bulk Add ")])),Jt,t(c)?p("",!0):(i(),u("th",Kt)),Lt,Qt,Yt,Ht,Xt])]),e("tbody",{ref_key:"to_move",ref:J},[(i(!0),u(P,null,Ve(t(a),(n,w)=>(i(),u(P,{key:w},[n.status!="Remove"?(i(),u("tr",{key:0,"data-index":w,draggable:"true",onDragstart:_=>he(_,w),onDragover:s[8]||(s[8]=Z(()=>{},["prevent"])),onDrop:_=>we(_,w)},[t(c)?p("",!0):(i(),u("td",Zt,[e("div",es,[e("button",{type:"button",name:"button",onClick:_=>fe(_,w)},[h(g)],8,ts)])])),e("td",null,f(w+1)+".",1),t(c)?p("",!0):(i(),u("td",ss,[e("div",ls,[n.item_id?(i(),u("button",{key:1,type:"button",onClick:_=>ue(_,w),disabled:n.confirm_by},[h(S,{class:"font-bold text-2xl"})],8,as)):(i(),u("button",{key:0,type:"button",name:"button",onClick:_=>ne(_,w)}," ... ",8,os))])])),e("td",{class:I(["cell bold",t(c)?"unselectable":""])},[e("div",ns,f(n.item.id),1)],2),e("td",{class:I(["cell",t(c)?"unselectable":""])},[e("div",is,f(n.item.name),1)],2),e("td",us,[e("div",cs,[(i(),ee(M,{disabled:t(c)||t(o).type=="used"||t(o).type=="transfer",key:w,class:"w-full h-full p-1",type:"text",value:n.qty_in||0,onInput:_=>n.qty_in=_,tabindex:t(a).length*0+1},null,8,["disabled","value","onInput","tabindex"]))])]),e("td",ds,[e("div",rs,[(i(),ee(M,{disabled:t(c)||t(o).type=="in",key:w,class:"w-full h-full p-1",type:"text",value:n.qty_out||0,onInput:_=>n.qty_out=_,tabindex:t(a).length*1+1},null,8,["disabled","value","onInput","tabindex"]))])]),e("td",_s,[e("div",fs,[W(e("textarea",{disabled:t(c),class:"p-1 w-full","onUpdate:modelValue":_=>n.note=_,cols:"7",rows:"2",tabindex:t(a).length*2+1},null,8,ps),[[G,n.note]])])])],40,Gt)):p("",!0)],64))),128)),t(c)?p("",!0):(i(),u("tr",ms,[e("td",vs,[e("button",{type:"button",name:"button",onClick:s[9]||(s[9]=n=>pe())},[h(x)])])]))],512)])],512)])]),e("div",hs,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:s[10]||(s[10]=n=>l.$router.go(-1))}," Cancel "),t(c)?p("",!0):(i(),u("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:s[11]||(s[11]=Z(n=>re(),["prevent"]))}," Save "))])])]),h(xe,{show:t(k),fnClose:le,fnSelect:oe,fnSelectMulti:ae,exclude_lists:t(b),enableMultiSelect:t(q),multi_key:["id","name"]},null,8,["show","exclude_lists","enableMultiSelect"]),h(ye,{show:t(A),fnClose:ce,fnSelect:de,opt:t($),exclude:t(_e)},null,8,["show","opt","exclude"]),h(be,{show:t(j),coor:t(F),fn:me,data:t(a),data_index:t(r),onReplyAct:s[12]||(s[12]=n=>ve(n))},null,8,["show","coor","data","data_index"])],64)}}});export{As as default};
