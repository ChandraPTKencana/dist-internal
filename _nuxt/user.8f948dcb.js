import{_ as N}from"./HeaderPopup.vue.404bf79e.js";import{r as v,g as P,i as A,f as U,k as x,J as V,o as g,c as y,a as e,b as q,t as h,l as u,E,m as I,A as M,F as T,D as J,$ as O,C as H,x as c,y as b,p as R,e as G}from"./entry.a19beef1.js";import"./useUtils.2ea1120c.js";import{u as k}from"./useMyFetch.03b76c40.js";import{_ as K}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.0158b2c2.js";const $=i=>(R("data-v-0ff3ff9c"),i=i(),G(),i),Q={class:"box-fixed"},W={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},X={class:"w-full flex flex-col items-center grow overflow-auto"},Y={class:"w-full flex flex-row flex-wrap"},Z={class:"w-full flex flex-col flex-wrap p-1"},ee=$(()=>e("label",{for:""},"Username",-1)),te={class:"card-border"},ae={class:"text-red-500"},se={class:"w-full flex flex-col sm:flex-row grow p-1 justify-between flex-wrap 2xl:overflow-hidden"},le={class:"w-full max-w-full p-0 2xl:pr-1 2xl:max-h-full 2xl:overflow-auto"},oe={class:"w-full",role:"sticky"},re={class:"tacky w-full !table-auto",style:{"white-space":"normal"}},ne=$(()=>e("tr",{class:"sticky -top-1 !z-[2]"},[e("td",{colspan:"2",class:"!bg-slate-800 text-white font-bold"}," Detail Permission List ")],-1)),ie={class:"sticky top-7 !z-[2]"},ue={class:"min-w-[20px] !w-[20px] max-w-[20px]"},de={class:"w-full flex items-center"},ce={ref:"to_move"},fe={class:"!w-[10px]"},pe={class:"w-full h-full flex items-center justify-center"},_e=["onUpdate:modelValue"],me={class:"w-full h-full flex items-center justify-start"},ve={class:"w-full flex items-center justify-end"},he={__name:"user",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},id:{type:Number,required:!1,default:0},p_data:{type:Array,required:!0,default:[]},is_copy:{type:[Boolean,Number],required:!0,default:!1}},setup(i){const n=i,C={id:-1,username:"",password:"",hak_akses:"PabrikTransport",is_active:1},l=v({...C}),w=P("token"),p=v({}),B=async()=>{c().loading_full=!0,p.value={};const a=new FormData;a.append("username",l.value.username),l.value.password&&a.append("password",l.value.password),a.append("hak_akses",l.value.hak_akses),a.append("is_active",l.value.is_active),a.append("permission_list",JSON.stringify(_.value));let t="post",r=n.is_copy?0:n.id;r==0||(a.append("id",r),a.append("_method","PUT"));const{data:s,error:m,status:d}=await k("/api/user",{method:t,headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:a,retry:0});if(c().loading_full=!1,d.value==="error"){b().trigger(m,p);return}if(r<=0)l.value.id=s.value.id,l.value.created_at=s.value.created_at,l.value.updated_at=s.value.updated_at,n.p_data.unshift(l.value);else{l.value.updated_at=s.value.updated_at;let S=n.p_data.map(L=>L.id).indexOf(r);S>=-1&&n.p_data.splice(S,1,{...l.value})}n.fnClose()},D=async()=>{c().loading_full=!0;const{data:a,error:t,status:r}=await k("/api/user",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{id:n.id},retry:0});if(c().loading_full=!1,r.value==="error"){b().trigger(t);return}l.value=a.value.data,a.value.data.details.forEach((s,m)=>{o.value=o.value.map(d=>(d.name==s.permission_list_name&&(d.checked=!0),d))})},o=v([]),j=async()=>{c().loading_full=!0;const{data:a,error:t,status:r}=await k("/api/permission_lists",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{sort:"name:asc"},retry:0});if(c().loading_full=!1,r.value==="error"){b().trigger(t);return}o.value=a.value.data.map(s=>(s.checked=!1,s))},_=A(a=>o.value.filter(t=>t.checked)),z=a=>{_.value.length!=o.value.length?o.value=o.value.map(t=>(t.checked=!0,t)):o.value=o.value.map(t=>(t.checked=!1,t))},f=v(""),F=A(()=>f.value!=""?o.value.filter(a=>a.name.toLowerCase().includes(f.value.toLowerCase())):o.value);return U(()=>n.show,async(a,t)=>{a==!0&&(l.value={...C},o.value=[],await j(),p.value={},n.id!=0&&await D())},{immediate:!0}),(a,t)=>{const r=N;return x((g(),y("section",Q,[e("div",null,[q(r,{title:"Form User",fn:i.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",W,[e("div",X,[e("div",Y,[e("div",Z,[ee,e("div",te,h(u(l).username),1),e("p",ae,h(u(p).username),1)])]),e("div",se,[e("div",le,[e("div",oe,[e("table",re,[e("thead",null,[ne,e("tr",ie,[e("th",ue,[e("button",{type:"button",name:"button",class:E(["text-xs",u(_).length!=u(o).length?"bg-green-500":"bg-red-500"]),onClick:t[0]||(t[0]=s=>z())},h(u(_).length!=u(o).length?"Allow":"Deny"),3)]),e("th",null,[e("div",de,[x(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>I(f)?f.value=s:null),name:"search",placeholder:"Name"},null,512),[[M,u(f)]])])])])]),e("tbody",ce,[(g(!0),y(T,null,J(u(F),(s,m)=>(g(),y("tr",{key:m},[e("td",fe,[e("div",pe,[x(e("input",{type:"checkbox","onUpdate:modelValue":d=>s.checked=d,class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"},null,8,_e),[[O,s.checked]])])]),e("td",null,[e("div",me,h(s.name),1)])]))),128))],512)])])])])]),e("div",ve,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:t[2]||(t[2]=s=>i.fnClose())}," Cancel "),e("button",{type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:t[3]||(t[3]=H(s=>B(),["prevent"]))}," Save ")])])])],512)),[[V,i.show]])}}},Ce=K(he,[["__scopeId","data-v-0ff3ff9c"]]);export{Ce as default};
