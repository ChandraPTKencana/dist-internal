import Q from"./Header.1fd8a3ba.js";import X from"./Signature.583615e8.js";import ee from"./Eyes.da25c106.js";import te from"./TableView.98b9fd7f.js";import ae from"./transaction_validasi.90eb8289.js";import{r as a,f as H,g as se,h as oe,i as v,j as V,s as le,c as O,b as y,a as _,k as re,v as ne,l as n,m as ie,n as F,w as g,q as ue,x as m,y as R,o as N,d as h,t as w}from"./entry.622940e4.js";import{u as f}from"./useUtils.3d22bd33.js";import{u as j}from"./useMyFetch.83f6fc10.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.dc4ae93e.js";import"./Adjust.dcbba02e.js";import"./TableHeaderEye.669aa100.js";import"./Times.4935bce4.js";import"./ClearAll.7a606fcd.js";import"./client-only.e189025b.js";import"./ClearEach.7ad82d61.js";import"./CaretLeftDoubleBold.dcc301af.js";import"./CaretLeftBold.be2d89c6.js";import"./CaretRightBold.455205fd.js";import"./CaretRightDoubleBold.07819556.js";import"./HeaderPopup.vue.01948059.js";import"./PopupMini.vue.c340a904.js";import"./Exclamation.3a10a9b9.js";const de={class:"w-full h-full flex flex-col"},_e={class:"w-full flex grow flex-col overflow-auto h-0"},ce={class:"w-full flex justify-between flex-wrap"},me={class:"grow flex"},fe={class:"m-1"},ve=_("option",{value:"pending-req"},"Pending",-1),pe=_("option",{value:"done-req"},"Done",-1),ye=_("option",{value:"all-req"},"All",-1),ge=[ve,pe,ye],Je={__name:"transfer",async setup(he){let b,q;const z=e=>e.deleted==1?"!bg-red-400":e.input_at?"!bg-blue-300":"",c=a("pending-req");H(()=>c.value,e=>{P()},{immediate:!1});const o={};o._TimeZoneOffset=new Date().getTimezoneOffset(),o.sort="created_at:desc";const A=se("token"),{data:I}=([b,q]=oe(async()=>ue(async()=>{let e=[];m().loading_full=!0;const{data:t,error:p,status:C}=await j("/api/transactions",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:{filter_status:c},retry:0});return m().loading_full=!1,C.value==="error"?(R().trigger(p),{transactions:e}):(e=t.value.data,{transactions:e})},"$GR5FA7sfoq")),b=await b,q(),b),i=a(I.value.transactions);a("");const x=a({field:"created_at",by:"desc"}),r=a(-1),u=a({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),d=v(()=>i.value[r.value]),J=()=>{o.like="";let e=JSON.parse(JSON.stringify(m()._tv.global_keyword));e!=""&&(o.like=`id:%${e}%,warehouse_name:%${e}%,warehouse_source_name:%${e}%,status:%${e}%,type:%${e}%`),o.sort="",x.value.field&&(o.sort=x.value.field+":"+x.value.by),o.filter_model=JSON.stringify(m()._tv.filter_model)};a(null);const $=async()=>{m().loading_full=!0,u.value.may_get_data=!1,o.page=u.value.page,o.page==1&&(i.value=[]),o.last_row&&delete o.last_row,o.page>1&&(o.last_row=JSON.stringify(i.value[i.value.length-1])),o.filter_status=c.value;const{data:e,error:t,status:p}=await j("/api/transactions",{method:"get",headers:{Authorization:`Bearer ${A.value}`,Accept:"application/json"},params:o,retry:0});if(m().loading_full=!1,u.value.may_get_data=!0,p.value==="error"){R().trigger(t);return}u.value.page==1?i.value=e.value.data:u.value.page>1&&(i.value=[...i.value,...e.value.data]),e.value.data.length==0&&(u.value.is_last_record=!0),m()._tv.filter_box=!1},P=()=>{r.value=-1,u.value.page=1,u.value.is_last_record=!1,J(),$()};a(!1),a(0);const T=a(0),D=a(!1),{display:B}=V();le(V());const k=a(!1),S=a(0),E=()=>{r.value==-1?B({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=i.value[r.value].id,D.value=!1,T.value=!1,k.value=!0)},U=()=>{r.value==-1?B({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(S.value=i.value[r.value].id,D.value=!0,T.value=!1,k.value=!0)};a({from:"",to:new Date});const M=a(!1);a({}),a(!1);const W=a("");H(()=>W.value,e=>{e.trim().length>0?M.value=!0:M.value=!1},{immediate:!1});const Y=a([{key:"no",label:"No",isai:!0},{key:"requested_at",label:"Requested At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"requested_by_username",label:"Requested By",filter_on:1,type:"string"},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"id",label:"ID",filter_on:1,freeze:1,type:"number",sort:{priority:1,type:"desc"}},{key:"warehouse_source_name",label:"Warehouse Source Name",filter_on:1,type:"string"},{key:"warehouse_target_name",label:"Warehouse Target Name",filter_on:1,type:"string"},{key:"warehouse_name",label:"Warehouse Name",filter_on:1,type:"string"},{key:"note",label:"Note",filter_on:1,type:"string"},{key:"status",label:"Status",filter_on:1,type:"string"},{key:"ref_id",label:"Ref ID",filter_on:1,type:"string"},{key:"confirmed_at",label:"Confirmed At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"confirmed_by_username",label:"Confirmed By",filter_on:1,type:"string"}]);v(()=>r.value>-1&&[void 0,0].indexOf(d.value.deleted)>-1&&f().checkPermission("transaction.create")),v(()=>["pending","all","done"].indexOf(c.value)>-1&&f().checkPermission("transaction.create")),v(()=>r.value>-1&&(d.value.ref_id==null||d.value.confirmed_by==null)&&[void 0,0].indexOf(d.value.deleted)>-1&&(f().checkPermission("transaction.val")&&[void 0,0].indexOf(d.value.val)>-1||f().checkPermission("transaction.val1")&&[void 0,0].indexOf(d.value.val1)>-1)&&f().checkPermissions(["transaction.modify"]));const L=v(()=>{var t;return r.value>-1&&f().checkPermission("transaction.val")&&[void 0,0,null].indexOf((t=d.value.confirmed_by)==null?void 0:t.username)>-1});return v(()=>r.value>-1&&f().checkPermission("transaction.remove")&&[void 0,0].indexOf(d.value.deleted)>-1),(e,t)=>{const p=Q,C=X,G=ee,Z=te,K=ae;return N(),O("div",de,[y(p,{title:"List Transaction"}),_("div",_e,[_("div",ce,[_("div",me,[_("div",fe,[re(_("select",{class:"","onUpdate:modelValue":t[0]||(t[0]=s=>ie(c)?c.value=s:null)},ge,512),[[ne,n(c)]])]),n(L)?(N(),O("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=s=>E())},[y(C)])):F("",!0),n(r)>-1?(N(),O("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=s=>U())},[y(G)])):F("",!0)])]),y(Z,{thead:n(Y),selected:n(r),onSetSelected:t[3]||(t[3]=s=>r.value=s),tbody:n(i),fnCallData:$,scrolling:n(u),onSetScrollingPage:t[4]||(t[4]=s=>n(u).page=s),onDoFilter:t[5]||(t[5]=s=>P()),rowBgColor:z},{warehouse_name:g(({item:s})=>{var l;return[h(w((l=s.warehouse)==null?void 0:l.name),1)]}),warehouse_source_name:g(({item:s})=>{var l;return[h(w((l=s.warehouse_source)==null?void 0:l.name),1)]}),warehouse_target_name:g(({item:s})=>{var l;return[h(w((l=s.warehouse_target)==null?void 0:l.name),1)]}),confirmed_by_username:g(({item:s})=>{var l;return[h(w((l=s.confirmed_by)==null?void 0:l.username),1)]}),requested_by_username:g(({item:s})=>{var l;return[h(w((l=s.requested_by)==null?void 0:l.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),y(K,{show:n(k),fnClose:()=>{k.value=!1},id:n(S),p_data:n(i),is_view:n(D)},null,8,["show","fnClose","id","p_data","is_view"])])}}};export{Je as default};
