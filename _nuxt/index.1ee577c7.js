import ye from"./Header.ec2830b8.js";import ge from"./Plus.cb543c06.js";import he from"./Edit.e3c2c2a7.js";import be from"./Eyes.d85ea6bd.js";import we from"./Delete.b19b9bfe.js";import ke from"./Signature.e2cc277b.js";import xe from"./TableView.27e3590f.js";import{_ as De}from"./PopupMini.vue.740d533e.js";import Ce from"./transaction.98cec2a1.js";import Se from"./transaction_validasi.caf61d5f.js";import{r as s,f as U,g as $e,h as Oe,i as h,j as L,s as Pe,c as b,b as d,a as _,k as W,v as Te,l as o,m as Y,n as O,w,q as Ae,x as m,y as E,o as k,d as x,t as P,A as Ne}from"./entry.468c1924.js";import{u as y}from"./useUtils.f67a7b52.js";import{u as H}from"./useMyFetch.5d39e20e.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Search.9b037104.js";import"./Adjust.cf28fd93.js";import"./TableHeaderEye.7cf37920.js";import"./Times.725e6b46.js";import"./ClearAll.34ea9b9e.js";import"./client-only.22df5fad.js";import"./ClearEach.6936ca01.js";import"./CaretLeftDoubleBold.3206de64.js";import"./CaretLeftBold.d337aee3.js";import"./CaretRightBold.65e7ac4a.js";import"./CaretRightDoubleBold.10274d1d.js";import"./Exclamation.b8184944.js";import"./HeaderPopup.vue.fe14bc58.js";import"./Tools.8903ba14.js";import"./InputPointFormat.vue.97c24bd4.js";import"./ToolsPopup.cc6bfdc0.js";import"./items.e63c3e9a.js";import"./PopupMiniMulti.vue.44803a63.js";import"./hrm_revisi_lokasis.9bc03651.js";const Be={class:"w-full h-full flex flex-col"},Me={class:"w-full flex grow flex-col overflow-auto h-0"},Fe={class:"w-full flex justify-between flex-wrap"},Ve={class:"grow flex"},je={class:"m-1"},qe=_("option",{value:"pending"},"Pending",-1),Ee=_("option",{value:"done"},"Done",-1),He=_("option",{value:"all"},"All",-1),Ie=[qe,Ee,He],ze={class:"grow mb-5"},xt={__name:"index",async setup(Je){let T,I;const Z=t=>t.deleted==1?"!bg-red-400":t.confirmed_by?"!bg-blue-300":"",c=s("pending");U(()=>c.value,t=>{J()},{immediate:!1});const r={};r._TimeZoneOffset=new Date().getTimezoneOffset(),r.sort="created_at:desc";const M=$e("token"),{data:K}=([T,I]=Oe(async()=>Ae(async()=>{let t=[];m().loading_full=!0;const{data:e,error:p,status:$}=await H("/api/transactions",{method:"get",headers:{Authorization:`Bearer ${M.value}`,Accept:"application/json"},params:{filter_status:c},retry:0});return m().loading_full=!1,$.value==="error"?(E().trigger(p),{transactions:t}):(t=e.value.data,{transactions:t})},"$4fKXj9ufhZ")),T=await T,I(),T),n=s(K.value.transactions);s("");const F=s({field:"created_at",by:"desc"}),l=s(-1),u=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),f=h(()=>n.value[l.value]),X=()=>{r.like="";let t=JSON.parse(JSON.stringify(m()._tv.global_keyword));t!=""&&(r.like=`id:%${t}%,warehouse_name:%${t}%,warehouse_source_name:%${t}%,status:%${t}%,type:%${t}%`),r.sort="",F.value.field&&(r.sort=F.value.field+":"+F.value.by),r.filter_model=JSON.stringify(m()._tv.filter_model)};s(null);const z=async()=>{m().loading_full=!0,u.value.may_get_data=!1,r.page=u.value.page,r.page==1&&(n.value=[]),r.last_row&&delete r.last_row,r.page>1&&(r.last_row=JSON.stringify(n.value[n.value.length-1])),r.filter_status=c.value;const{data:t,error:e,status:p}=await H("/api/transactions",{method:"get",headers:{Authorization:`Bearer ${M.value}`,Accept:"application/json"},params:r,retry:0});if(m().loading_full=!1,u.value.may_get_data=!0,p.value==="error"){E().trigger(e);return}u.value.page==1?n.value=t.value.data:u.value.page>1&&(n.value=[...n.value,...t.value.data]),t.value.data.length==0&&(u.value.is_last_record=!0),m()._tv.filter_box=!1},J=()=>{l.value=-1,u.value.page=1,u.value.is_last_record=!1,X(),z()},A=s(!1),V=s(0),D=s(0),C=s(!1),G=()=>{V.value=0,C.value=!1,D.value=!1,A.value=!0},{display:N}=L();Pe(L());const Q=()=>{l.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(V.value=n.value[l.value].id,C.value=!1,D.value=!1,A.value=!0)},B=s(!1),j=s(0),ee=()=>{l.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value=n.value[l.value].id,C.value=!1,D.value=!1,B.value=!0)},te=()=>{l.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(j.value=n.value[l.value].id,C.value=!0,D.value=!1,B.value=!0)};s({from:"",to:new Date});const q=s(!1),R=s({}),S=s(!1),g=s(""),ae=async()=>{S.value&&(S.value=!1)},oe=()=>{l.value==-1?N({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(g.value="",R.value={id:n.value[l.value].id},S.value=!0)};U(()=>g.value,t=>{t.trim().length>0?q.value=!0:q.value=!1},{immediate:!1});const le=async()=>{m().loading_full=!0;const t=new FormData;t.append("id",n.value[l.value].id),t.append("deleted_reason",g.value),t.append("_method","DELETE");const{data:e,error:p,status:$}=await H("/api/transaction",{method:"post",headers:{Authorization:`Bearer ${M.value}`,Accept:"application/json"},body:t,retry:0});if(m().loading_full=!1,$.value==="error"){E().trigger(p);return}let v={...n.value[l.value]};v.deleted=e.value.deleted,v.deleted_user=e.value.deleted_user,v.deleted_at=e.value.deleted_at,v.deleted_by=e.value.deleted_by,v.deleted_reason=e.value.deleted_reason,c.value!="all"?n.value.splice(l.value,1):n.value.splice(l.value,1,{...v}),l.value=-1,S.value=!1},se=s([{key:"no",label:"No",isai:!0},{key:"id",label:"ID",filter_on:1,freeze:1,type:"number",sort:{priority:1,type:"desc"}},{key:"requested_at",label:"Requested At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"requested_by_username",label:"Requested By",filter_on:1,type:"string"},{key:"warehouse_name",label:"Warehouse Name",filter_on:1,type:"string"},{key:"note",label:"Note",filter_on:1,type:"string"},{key:"status",label:"Status",filter_on:1,type:"string"},{key:"type",label:"Type",filter_on:1,type:"string"},{key:"warehouse_source_name",label:"Warehouse Source Name",filter_on:1,type:"string"},{key:"warehouse_target_name",label:"Warehouse Target Name",filter_on:1,type:"string"},{key:"confirmed_at",label:"Confirmed At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"confirmed_by_username",label:"Confirmed By",filter_on:1,type:"string"},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1}]);h(()=>l.value>-1&&[void 0,0].indexOf(f.value.deleted)>-1&&y().checkPermission("transaction.create"));const ne=h(()=>["pending","all","done"].indexOf(c.value)>-1&&y().checkPermission("transaction.create")),re=h(()=>l.value>-1&&(f.value.ref_id==null||f.value.confirmed_by==null)&&[void 0,0].indexOf(f.value.deleted)>-1&&(y().checkPermission("transaction.val")&&[void 0,0].indexOf(f.value.val)>-1||y().checkPermission("transaction.val1")&&[void 0,0].indexOf(f.value.val1)>-1)&&y().checkPermissions(["transaction.modify"])),ie=h(()=>{var e;return l.value>-1&&y().checkPermission("transaction.val")&&[void 0,0,null].indexOf((e=f.value.confirmed_by)==null?void 0:e.username)>-1}),ue=h(()=>l.value>-1&&y().checkPermission("transaction.remove")&&[void 0,0].indexOf(f.value.deleted)>-1);return(t,e)=>{const p=ye,$=ge,v=he,de=be,_e=we,me=ke,ce=xe,fe=De,ve=Ce,pe=Se;return k(),b("div",Be,[d(p,{title:"List Transaction"}),_("div",Me,[_("div",Fe,[_("div",Ve,[_("div",je,[W(_("select",{class:"","onUpdate:modelValue":e[0]||(e[0]=a=>Y(c)?c.value=a:null)},Ie,512),[[Te,o(c)]])]),o(ne)?(k(),b("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[1]||(e[1]=a=>G())},[d($)])):O("",!0),o(re)?(k(),b("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[2]||(e[2]=a=>Q())},[d(v)])):O("",!0),o(l)>-1?(k(),b("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[3]||(e[3]=a=>te())},[d(de)])):O("",!0),o(ue)?(k(),b("button",{key:3,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[4]||(e[4]=a=>oe())},[d(_e)])):O("",!0),o(ie)?(k(),b("button",{key:4,type:"button",name:"button",class:"m-1 text-2xl",onClick:e[5]||(e[5]=a=>ee())},[d(me)])):O("",!0)])]),d(ce,{thead:o(se),selected:o(l),onSetSelected:e[6]||(e[6]=a=>l.value=a),tbody:o(n),fnCallData:z,scrolling:o(u),onSetScrollingPage:e[7]||(e[7]=a=>o(u).page=a),onDoFilter:e[8]||(e[8]=a=>J()),rowBgColor:Z},{warehouse_name:w(({item:a})=>{var i;return[x(P((i=a.warehouse)==null?void 0:i.name),1)]}),warehouse_source_name:w(({item:a})=>{var i;return[x(P((i=a.warehouse_source)==null?void 0:i.name),1)]}),warehouse_target_name:w(({item:a})=>{var i;return[x(P((i=a.warehouse_target)==null?void 0:i.name),1)]}),confirmed_by_username:w(({item:a})=>{var i;return[x(P((i=a.confirmed_by)==null?void 0:i.username),1)]}),requested_by_username:w(({item:a})=>{var i;return[x(P((i=a.requested_by)==null?void 0:i.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])]),d(fe,{type:"delete",show:o(S),data:o(R),fnClose:ae,fnConfirm:le,enabledOk:o(q)},{footer:w(()=>[x(" Masukkan Alasan Penghapusan: "),_("div",ze,[W(_("textarea",{"onUpdate:modelValue":e[9]||(e[9]=a=>Y(g)?g.value=a:null)},null,512),[[Ne,o(g)]])])]),_:1},8,["show","data","enabledOk"]),d(ve,{show:o(A),fnClose:()=>{A.value=!1},id:o(V),p_data:o(n),is_copy:o(D)},null,8,["show","fnClose","id","p_data","is_copy"]),d(pe,{show:o(B),fnClose:()=>{B.value=!1},id:o(j),p_data:o(n),is_view:o(C)},null,8,["show","fnClose","id","p_data","is_view"])])}}};export{xt as default};
