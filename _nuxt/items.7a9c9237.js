import{_ as Y}from"./HeaderPopup.vue.01948059.js";import G from"./Search.dc4ae93e.js";import{_ as Z}from"./PopupMiniMulti.vue.1ac3a678.js";import{g as Q,r as u,f as W,o as _,c as m,k as b,J as X,a as e,b as A,m as ee,A as te,l as i,v as I,C as se,n as D,F as N,D as le,E as oe,t as h,d as ae,G as ne,p as ie,e as re,x as F,y as ce}from"./entry.622940e4.js";import{u as ue}from"./useUtils.3d22bd33.js";import{u as de}from"./useMyFetch.83f6fc10.js";import{_ as fe}from"./_plugin-vue_export-helper.c27b6911.js";import"./Times.4935bce4.js";const o=r=>(ie("data-v-d0674591"),r=r(),re(),r),_e={class:"box-fixed"},me={action:"#",class:"w-full flex p-1"},pe={class:"grow"},ve=o(()=>e("div",{class:"font-bold"}," Keyword ",-1)),he={class:"pl-1"},ye=o(()=>e("div",{class:"font-bold"}," Sort By ",-1)),we=o(()=>e("option",{value:"created_at"},"Created At",-1)),xe=o(()=>e("option",{value:"id"},"ID",-1)),ge=o(()=>e("option",{value:"name"},"Nama",-1)),ke=[we,xe,ge],be={class:"pl-1"},Se=o(()=>e("div",{class:"font-bold"}," Sort Order ",-1)),Me=o(()=>e("option",{value:"asc"},"Asc",-1)),Ce=o(()=>e("option",{value:"desc"},"Desc",-1)),Ae=[Me,Ce],De={class:"flex items-end pl-1"},$e={class:"w-full flex justify-center items-center grow h-0 p-1"},Le={key:0,class:""},Te={class:"tacky w-full"},Ie={class:"sticky top-0 !z-[2]"},Ne={key:0,class:"min-w-[28px] !w-[28px] max-w-[28px]"},Fe=o(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No.",-1)),Ve=o(()=>e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID",-1)),qe=o(()=>e("th",null,"Name",-1)),Oe=o(()=>e("th",null,"Unit",-1)),Be=o(()=>e("th",{class:"min-w-[170px] !w-[170px] max-w-[170px]"},"Created At",-1)),He=o(()=>e("th",{class:"min-w-[170px] !w-[170px] max-w-[170px]"},"Updated At",-1)),Re=["onClick"],Ue={key:0},Ke=["checked","onClick"],je={class:"bold"},ze={class:"whitespace-normal break-words"},Ee={class:"flex",style:{"justify-content":"end",padding:"5px"}},Je={key:0,class:"grow flex items-center"},Pe={__name:"items",props:{show:{type:Boolean,required:!0},fnClose:{type:Function,required:!1},fnSelect:{type:Function,required:!1},fnSelectMulti:{type:Function,required:!1},enableMultiSelect:{type:Boolean,required:!1},excludes:{type:String,required:!1},exclude_lists:{type:Array,required:!1},multi_key:{type:Array,required:!1}},setup(r){const d=r,{$moment:$}=ne(),{countClickListFn:V}=ue(),q=Q("token"),f=u([]),y=u(""),p=u({field:"created_at",by:"desc"}),x=u(-1),a=u({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),n={};n._TimeZoneOffset=new Date().getTimezoneOffset();const O=()=>{n.like="",y.value!=""&&(n.like=`id:%${y.value}%,name:%${y.value}%`),n.sort="",p.value.field&&(n.sort=p.value.field+":"+p.value.by)},g=u(null),L=async()=>{F().loading_full=!0,a.value.may_get_data=!1,n.page=a.value.page,n.page==1&&(f.value=[]),d.exclude_lists&&(n.exclude_lists=JSON.stringify(d.exclude_lists)),n.first_row&&delete n.first_row,n.page>1&&(n.first_row=JSON.stringify(f.value[0]));const{data:t,error:s,status:v}=await de("/api/items",{method:"get",headers:{Authorization:`Bearer ${q.value}`,Accept:"application/json"},params:n,retry:0});if(F().loading_full=!1,a.value.may_get_data=!0,v.value==="error"){ce().trigger(s);return}a.value.page==1?(f.value=t.value.data,g.value&&(g.value.scrollTop=0)):a.value.page>1&&(f.value=[...f.value,...t.value.data]),t.value.data.length==0&&(a.value.is_last_record=!0)},B=async()=>{if(!a.value.may_get_data)return;let t=g.value;if(t.scrollLeft!=a.value.scrollLeft){a.value.scrollLeft=t.scrollLeft;return}a.value.is_last_record||!(Math.round(t.scrollTop)+t.clientHeight>=t.scrollHeight-1)||(a.value.page++,await L())},S=()=>{a.value.page=1,a.value.is_last_record=!1,O(),L()},w=u(!1),c=u([]),M=()=>{d.enableMultiSelect?(d.fnSelectMulti(c.value),w.value=!1):x.value>-1?d.fnSelect(f.value[x.value]):d.fnSelect({id:"",name:""})},H=t=>{d.enableMultiSelect||V(t,()=>{x.value=t},M)},R=t=>{c.value.splice(t,1)},U=async()=>{w.value&&(w.value=!1)},K=t=>{const s=c.value.map(v=>v.id).indexOf(t.id);s===-1?c.value.push(t):c.value.splice(s,1)},j=t=>c.value.map(v=>v.id).indexOf(t.id)!==-1,T=u(null);let C=null;const z=t=>{C&&clearTimeout(C),C=setTimeout(()=>{S()},500)};return W(()=>d.show,(t,s)=>{t==!0&&(c.value=[],S(),setTimeout(()=>{T.value.focus()},100))},{immediate:!0}),(t,s)=>{const v=Y,E=G,J=Z;return _(),m(N,null,[b(e("section",_e,[e("div",null,[A(v,{title:"Search And Select Item",fn:r.fnClose,class:"w-100 flex align-items-center",style:{color:"white"}},null,8,["fn"]),e("form",me,[e("div",pe,[ve,b(e("input",{ref_key:"ref_keyword",ref:T,class:"",type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>ee(y)?y.value=l:null),name:"search",placeholder:"Keyword",onKeyup:s[1]||(s[1]=l=>z())},null,544),[[te,i(y)]])]),e("div",he,[ye,b(e("select",{class:"","onUpdate:modelValue":s[2]||(s[2]=l=>i(p).field=l)},ke,512),[[I,i(p).field]])]),e("div",be,[Se,b(e("select",{class:"","onUpdate:modelValue":s[3]||(s[3]=l=>i(p).by=l)},Ae,512),[[I,i(p).by]])]),e("div",De,[e("button",{class:"",type:"submit",name:"button",onClick:s[4]||(s[4]=se(l=>S(),["prevent"]))},[A(E,{class:"text-2xl"})])])]),e("div",$e,[i(f).length==0?(_(),m("div",Le," Maaf Tidak Ada Record ")):(_(),m("div",{key:1,class:"w-full h-full overflow-auto",role:"sticky",ref_key:"loadRef",ref:g,onScroll:B},[e("table",Te,[e("thead",null,[e("tr",Ie,[r.enableMultiSelect?(_(),m("th",Ne)):D("",!0),Fe,Ve,qe,Oe,Be,He])]),e("tbody",null,[(_(!0),m(N,null,le(i(f),(l,k)=>(_(),m("tr",{key:k,onClick:P=>H(k),class:oe(i(x)==k?"active":"")},[r.enableMultiSelect?(_(),m("td",Ue,[e("input",{type:"checkbox",checked:j(l),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",onClick:P=>K(l)},null,8,Ke)])):D("",!0),e("td",null,h(k+1)+".",1),e("td",je,h(l.id),1),e("td",ze,h(l.name),1),e("td",null,h(l.unit.name),1),e("td",null,h(i($)(l.created_at).format("DD-MM-Y HH:mm:ss")),1),e("td",null,h(i($)(l.updated_at).format("DD-MM-Y HH:mm:ss")),1)],10,Re))),128))])])],544))]),e("div",Ee,[r.enableMultiSelect?(_(),m("div",Je,[ae(" Selected Items: "+h(i(c).length)+" ",1),e("button",{type:"button",class:"ml-3",onClick:s[5]||(s[5]=l=>w.value=!0)}," View all Items ")])):D("",!0),e("button",{onClick:s[6]||(s[6]=l=>M()),class:"w-36 m-1 bg-blue-600 text-white rounded-sm"}," Select ")])])],512),[[X,r.show]]),A(J,{show:i(w),data:i(c),fnClose:U,fnConfirm:M,multi_key:r.multi_key,fnRemoveFromList:R},null,8,["show","data","multi_key"])],64)}}},st=fe(Pe,[["__scopeId","data-v-d0674591"]]);export{st as default};
