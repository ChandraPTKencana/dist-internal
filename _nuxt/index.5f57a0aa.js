import se from"./Header.ec2830b8.js";import re from"./Plus.cb543c06.js";import ne from"./Edit.e3c2c2a7.js";import ie from"./Delete.b19b9bfe.js";import ue from"./TableView.27e3590f.js";import{_ as de}from"./PopupMini.vue.740d533e.js";import _e from"./item.f77aedfe.js";import{r as s,f as U,g as me,h as ce,i as g,j as J,s as fe,c as b,a as x,b as c,l as r,n as $,w as A,F as pe,q as ve,x as u,y as B,o as h,d as N,t as O}from"./entry.468c1924.js";import{u as F}from"./useMyFetch.5d39e20e.js";import{u as P}from"./useUtils.f67a7b52.js";import{_ as ye}from"./_plugin-vue_export-helper.c27b6911.js";import"./Search.9b037104.js";import"./Adjust.cf28fd93.js";import"./TableHeaderEye.7cf37920.js";import"./Times.725e6b46.js";import"./ClearAll.34ea9b9e.js";import"./client-only.22df5fad.js";import"./ClearEach.6936ca01.js";import"./CaretLeftDoubleBold.3206de64.js";import"./CaretLeftBold.d337aee3.js";import"./CaretRightBold.65e7ac4a.js";import"./CaretRightDoubleBold.10274d1d.js";import"./Exclamation.b8184944.js";import"./HeaderPopup.vue.fe14bc58.js";import"./InputPointFormat.vue.97c24bd4.js";import"./units.838f6923.js";const ge={class:"w-full h-full flex flex-col"},be={class:"w-full flex grow flex-col overflow-auto h-0"},xe={class:"w-full flex justify-between flex-wrap"},he={class:"grow flex"},we={__name:"index",async setup(ke){let v,T;const L=e=>e.deleted==1?"!bg-red-400":e.val==0?"!bg-gray-300":"",f=s("available");U(()=>f.value,e=>{j()},{immediate:!1});const n={};n._TimeZoneOffset=new Date().getTimezoneOffset();const w=me("token"),{data:l}=([v,T]=ce(async()=>ve(async()=>{u().loading_full=!0;const{data:e,error:t,status:m}=await F("/api/items",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:{filter_status:f},retry:0});return u().loading_full=!1,m.value==="error"?(B().trigger(t),[]):e.value.data},"$h43u6e3fEi")),v=await v,T(),v);s("");const k=s({field:"",by:"desc"}),a=s(-1),i=s({page:1,is_last_record:!1,scrollLeft:0,may_get_data:!0}),E=g(()=>l.value[a.value]),Y=()=>{n.like="";let e=JSON.parse(JSON.stringify(u()._tv.global_keyword));e!=""&&(n.like=`id:%${e}%,name:%${e}%,value:%${e}%`),n.sort="",k.value.field&&(n.sort=k.value.field+":"+k.value.by),n.filter_model=JSON.stringify(u()._tv.filter_model)},I=async()=>{u().loading_full=!0,i.value.may_get_data=!1,n.page=i.value.page,n.page==1&&(l.value=[]),n.filter_status=f.value;const{data:e,error:t,status:m}=await F("/api/items",{method:"get",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},params:n,retry:0});if(u().loading_full=!1,i.value.may_get_data=!0,m.value==="error"){B().trigger(t);return}i.value.page==1?l.value=e.value.data:i.value.page>1&&(l.value=[...l.value,...e.value.data]),e.value.data.length==0&&(i.value.is_last_record=!0),u()._tv.filter_box=!1},j=()=>{a.value=-1,i.value.page=1,i.value.is_last_record=!1,Y(),I()},y=s(!1),D=s(0),M=s(!1),q=()=>{D.value=0,M.value=!1,y.value=!0},{display:V}=J();fe(J());const R=()=>{a.value==-1?V({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(D.value=l.value[a.value].id,M.value=!1,y.value=!0)},H=s(!1),z=s({}),p=s(!1),C=s(""),Z=async()=>{p.value&&(p.value=!1)},G=()=>{a.value==-1?V({show:!0,status:"Failed",message:"Silahkan Pilih Data Terlebih Dahulu"}):(C.value="",z.value={id:l.value[a.value].id,name:l.value[a.value].name},p.value=!0)};U(()=>C.value,e=>{e.trim().length>0?H.value=!0:H.value=!1},{immediate:!1});const K=async()=>{u().loading_full=!0;const e=new FormData;e.append("id",l.value[a.value].id),e.append("deleted_reason",C.value),e.append("_method","DELETE");const{data:t,error:m,status:S}=await F("/api/item",{method:"post",headers:{Authorization:`Bearer ${w.value}`,Accept:"application/json"},body:e,retry:0});if(u().loading_full=!1,S.value==="error"){B().trigger(m);return}let d={...l.value[a.value]};d.deleted=t.value.deleted,d.deleted_user=t.value.deleted_user,d.deleted_at=t.value.deleted_at,d.deleted_by=t.value.deleted_by,d.deleted_reason=t.value.deleted_reason,f.value!="all"?l.value.splice(a.value,1):l.value.splice(a.value,1,{...d}),a.value=-1,p.value=!1},Q=s([{key:"no",label:"No",isai:!0},{key:"id",label:"ID",filter_on:1,type:"number"},{key:"name",label:"Name",filter_on:1,type:"string",sort:{priority:1,type:"asc"}},{key:"unit_name",label:"Unit",filter_on:1,type:"string"},{key:"value",label:"Value",filter_on:1,type:"number"},{key:"note",label:"Note",filter_on:1,type:"string"},{key:"created_at",label:"Created At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"created_by_username",label:"Created_By"},{key:"updated_at",label:"Updated At",type:"datetime",dateformat:"DD-MM-Y HH:mm:ss",filter_on:1},{key:"updated_by_username",label:"Updated_By"}]),W=g(()=>["available","all","unapprove"].indexOf(f.value)>-1&&P().checkPermission("item.create")),X=g(()=>a.value>-1&&[void 0,0].indexOf(E.value.deleted)>-1&&P().checkPermissions(["item.modify"])),ee=g(()=>a.value>-1&&P().checkPermission("item.remove")&&[void 0,0].indexOf(E.value.deleted)>-1);return(e,t)=>{const m=se,S=re,d=ne,te=ie,ae=ue,le=de,oe=_e;return h(),b(pe,null,[x("div",ge,[c(m,{title:"List Item"}),x("div",be,[x("div",xe,[x("div",he,[r(W)?(h(),b("button",{key:0,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[0]||(t[0]=o=>q())},[c(S)])):$("",!0),r(X)?(h(),b("button",{key:1,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[1]||(t[1]=o=>R())},[c(d)])):$("",!0),r(ee)?(h(),b("button",{key:2,type:"button",name:"button",class:"m-1 text-2xl",onClick:t[2]||(t[2]=o=>G())},[c(te)])):$("",!0)])]),c(ae,{thead:r(Q),selected:r(a),onSetSelected:t[3]||(t[3]=o=>a.value=o),tbody:r(l),fnCallData:I,scrolling:r(i),onSetScrollingPage:t[4]||(t[4]=o=>r(i).page=o),onDoFilter:t[5]||(t[5]=o=>j()),rowBgColor:L},{unit_name:A(({item:o})=>{var _;return[N(O((_=o.unit)==null?void 0:_.name),1)]}),created_by_username:A(({item:o})=>{var _;return[N(O((_=o.created_by)==null?void 0:_.username),1)]}),updated_by_username:A(({item:o})=>{var _;return[N(O((_=o.updated_by)==null?void 0:_.username),1)]}),_:2},1032,["thead","selected","tbody","scrolling"])])]),c(le,{type:"delete",show:r(p),data:r(z),fnClose:Z,fnConfirm:K},null,8,["show","data"]),c(oe,{show:r(y),fnClose:()=>{y.value=!1},id:r(D),p_data:r(l)},null,8,["show","fnClose","id","p_data"])],64)}}},Ke=ye(we,[["__scopeId","data-v-8205dd70"]]);export{Ke as default};
