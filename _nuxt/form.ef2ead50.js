import{_ as ge}from"./Search.685f564f.js";import{_ as ke}from"./Delete.cf8f3b41.js";import{u as Se,_ as Ie,a as Ce,b as De,c as Ne}from"./ToolsPopup.49ab2d47.js";import{_ as Ae}from"./Times.dff09cfb.js";import{_ as $e}from"./InputPointFormat.vue.a96a37b2.js";import{_ as je}from"./Plus.614af9fc.js";import{n as Me,u as Te,q as Y,r as v,s as Be,v as Oe,x as Re,y as qe,C as T,D as H,Q as X,R as We,o as i,c as u,a as e,B as t,t as f,O as m,z as W,H as Ee,K as C,b as w,A as G,I as E,J as Pe,N as Z,S as ee,E as Ve}from"./entry.2f2c890d.js";import{u as te}from"./useMyFetch.0b69aeb4.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./HeaderPopup.vue.0267283d.js";import"./useUtils.100f5b4a.js";const Ue={class:"w-full h-full flex flex-col border-t-4 border-slate-600"},ze={action:"#",class:"w-full flex grow flex-col h-0 overflow-auto bg-white"},Fe={class:"w-full flex flex-col items-center justify-center grow overflow-auto"},Je={class:"w-full flex flex-row flex-wrap"},Ke={key:0,class:"w-full sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},Le=e("label",{for:""},"Input At",-1),Qe={class:"card-border"},Ye={class:"w-full flex flex-col flex-wrap p-1 sm:w-4/12 md:w-3/12 lg:w-2/12"},He=e("label",{for:""},"Type",-1),Xe=["disabled"],Ge=e("option",{value:"used"},"Used",-1),Ze=e("option",{value:"in"},"In",-1),et=e("option",{value:"transfer"},"Transfer",-1),tt=[Ge,Ze,et],st={class:"text-red-500"},lt={class:"w-full sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},ot=e("label",{for:""},"From Warehouse",-1),at={key:0,class:"w-full flex"},nt=e("div",{class:"flex items-center grow p-1"}," Pilih Warehouse yang dikelola ",-1),it={key:1,class:"w-full flex",style:{}},ut={class:"flex flex-row flex-wrap grow"},ct={class:"p-1"},rt=e("div",{class:"text-sm text-gray-600"},"ID",-1),dt={class:"bold"},_t={class:"p-1"},ft=e("div",{class:"text-sm text-gray-600"},"Name",-1),mt={class:"bold"},pt={class:"flex flex-row flex-wrap grow"},vt={class:"p-1"},ht=e("div",{class:"text-sm text-gray-600"},"ID",-1),wt={class:"bold"},xt={class:"p-1"},yt=e("div",{class:"text-sm text-gray-600"},"Name",-1),bt={class:"bold"},gt={class:"text-red-500"},kt={key:1,class:"w-full sm:w-4/12 md:w-3/12 lg:w-2/12 flex flex-col flex-wrap p-1"},St=e("label",{for:""},"To Warehouse",-1),It={key:0,class:"w-full flex"},Ct=e("div",{class:"flex items-center grow p-1"}," Pilih Warehouse Target ",-1),Dt={key:1,class:"w-full flex",style:{}},Nt={class:"flex flex-row flex-wrap grow"},At={class:"p-1"},$t=e("div",{class:"text-sm text-gray-600"},"ID",-1),jt={class:"bold"},Mt={class:"p-1"},Tt=e("div",{class:"text-sm text-gray-600"},"Name",-1),Bt={class:"bold"},Ot={class:"text-red-500"},Rt={class:"w-full sm:w-4/12 md:w-3/12 lg:w-3/12 flex flex-col flex-wrap p-1"},qt=e("label",{for:""},"Note",-1),Wt=["disabled"],Et={class:"text-red-500"},Pt={class:"w-full flex grow p-1 overflow-auto"},Vt={role:"sticky",ref:"loadRef"},Ut={class:"tacky w-full",style:{"white-space":"normal"}},zt={class:"sticky top-0 !z-[2]"},Ft={key:0,class:"min-w-[50px] !w-[50px] max-w-[50px]"},Jt=e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"No",-1),Kt={key:1,class:"min-w-[50px] !w-[50px] max-w-[50px]"},Lt=e("th",{class:"min-w-[50px] !w-[50px] max-w-[50px]"},"ID Item",-1),Qt=e("th",null,"Nama Item",-1),Yt=e("th",{class:"min-w-[80px] !w-[80px] max-w-[80px]"},"Qty In",-1),Ht=e("th",{class:"min-w-[80px] !w-[80px] max-w-[80px]"},"Qty Out",-1),Xt=e("th",null,"Keterangan",-1),Gt=["data-index","onDragstart","onDrop"],Zt={key:0,class:"tools cell"},es={class:"w-full h-full flex items-center justify-center"},ts=["onClick"],ss={key:1,class:"cell"},ls={class:"w-full h-full flex items-center justify-center"},os=["onClick"],as=["onClick","disabled"],ns={class:"w-full h-full flex items-center justify-center"},is={class:"w-full h-full flex items-center justify-center"},us={class:"cell"},cs={class:"w-full h-full flex items-center justify-center"},rs={class:"cell"},ds={class:"w-full h-full flex items-center justify-center"},_s={class:"cell"},fs={class:"w-full h-full flex items-center justify-center"},ms=["disabled","onUpdate:modelValue","tabindex"],ps={key:0},vs={class:"tools cell"},hs={class:"w-full flex items-center justify-end"},As=Me({__name:"form",props:{id:{type:Number,required:!1}},async setup(se){var K,L,Q;let D,P;const V=se;Te();const U=Y("token"),b=v({});Be(),Oe();let N={id:"",name:""};const{data:B}=([D,P]=Re(async()=>qe(async()=>{const l=V.id;let s=null,r=null,p=null;if(l!=null&&l!==""){T().loading_full=!0;const{data:k,error:I,status:h}=await te("/api/transaction",{method:"get",headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},params:{id:l},retry:0});T().loading_full=!1,h.value==="error"?H().trigger(I,b):(s=k.value.data,p=k.value.data.details.map(x=>(x.status="Edit",x.key=x.ordinal,x)),r=k.value.data.details.map(x=>x.item.id))}return{transaction:s,exclude_lists:r,details:p}},"$uMprYOKBrF")),D=await D,P(),D),o=v(((K=B.value)==null?void 0:K.transaction)||{id:-1,type:"used",note:"",warehouse:{...N},warehouse_target:{...N},details:[]}),g=v(((L=B.value)==null?void 0:L.exclude_lists)||[]),a=v(((Q=B.value)==null?void 0:Q.details)||[]),A=Y("locs");A.value&&A.value.length==1&&(o.value.warehouse={id:A.value[0].id,name:A.value[0].lokasi});const O=v({ordinal:0,item:{id:"",name:"",unit:{id:"",name:""}},item_id:"",qty_in:0,qty_out:0,note:"",status:""}),S=v(!1),le=()=>{S.value=!1},oe=l=>{a.value[d.value].item=l,a.value[d.value].item_id=l.id,g.value.push(l.id),S.value=!1},ae=l=>{l.forEach(s=>{let r={...O.value,status:"Add"};r.item=s,r.item_id=s.id,g.value.push(s.id),a.value.push(r)}),S.value=!1},R=v(!1),ne=(l,s)=>{d.value=s,R.value=!1,S.value=!0},ie=(l,s)=>{R.value=!0,S.value=!0},ue=(l,s)=>{let r=a.value[s].item.id,p=g.value.indexOf(r);p>-1&&g.value.splice(p,1),a.value[s].item_id="",a.value[s].item={id:"",name:"",unit:{id:"",name:""}}};let $=v(!1),j="";const q=l=>{l=="from"?o.value.warehouse={...N}:l=="to"&&(o.value.warehouse_target={...N})},z=l=>{j=l,$.value=!0},ce=()=>{$.value=!1},re=l=>{j=="from"?o.value.warehouse={...l}:j=="to"&&(o.value.warehouse_target={...l}),$.value=!1},de=async()=>{T().loading_full=!0,b.value={};let l={type:o.value.type,note:o.value.note,warehouse_id:o.value.warehouse.id,warehouse_target_id:o.value.warehouse_target.id,details:JSON.stringify(a.value)},s="post",r=V.id;r==null||(s="post",l.id=r,l._method="PUT");const{data:p,error:k,status:I}=await te("/api/transaction",{method:s,headers:{Authorization:`Bearer ${U.value}`,Accept:"application/json"},body:l,retry:0});if(T().loading_full=!1,I.value==="error"){H().trigger(k,b);return}Ve().display({show:!0,status:"Success",message:"Data Tersimpan"}),a.value=a.value.filter(h=>h.status!="Remove").map((h,x)=>(h.key||(h.key=x+1,h.status="Edit"),h))},_e=X(()=>{var l,s;return((l=o.value.warehouse)==null?void 0:l.id)||((s=o.value.warehouse_target)==null?void 0:s.id)||0}),d=v(-1),M=v(!1),F=v({left:0,top:0}),fe=(l,s)=>{d.value=s,M.value=!0,F.value={left:l.clientX,top:l.clientY}},me=()=>{a.value.push({...O.value,status:"Add"})},pe=()=>{M.value=!1},ve=(l="")=>{if(l=="insert")a.value.splice(d.value,0,{...O.value,status:"Add"});else if(l=="delete"){let s=a.value[d.value].item.id,r=g.value.indexOf(s);r>-1&&g.value.splice(r,1),a.value[d.value].status=="Edit"?a.value[d.value].status="Remove":a.value.splice(d.value,1)}else if(l=="move_top"){let s=a.value[d.value];a.value.splice(d.value,1),a.value.splice(d.value-1,0,{...s})}else if(l=="move_bottom"){let s=a.value[d.value];a.value.splice(d.value,1),a.value.splice(d.value+1,0,{...s})}M.value=!1},c=X(()=>o.value.confirmed_by||o.value.ref_id!=null),he=(l,s)=>{l.dataTransfer.setData("application/json",JSON.stringify(s))},we=(l,s)=>{let r=JSON.parse(l.dataTransfer.getData("application/json")),p=a.value[r];a.value.splice(r,1),a.value.splice(s,0,{...p})},J=v(null);return We(()=>{c.value||Se(J,a)}),(l,s)=>{const r=ge,p=ke,k=Ie,I=Ae,h=$e,x=je,xe=Ce,ye=De,be=Ne;return i(),u(E,null,[e("div",Ue,[e("form",ze,[e("div",Fe,[e("div",Je,[t(o).confirmed_by?(i(),u("div",Ke,[Le,e("div",Qe,f(l.$moment(t(o).input_at).format("DD-MM-Y")),1)])):m("",!0),e("div",Ye,[He,W(e("select",{disabled:t(c),class:"","onUpdate:modelValue":s[0]||(s[0]=n=>t(o).type=n)},tt,8,Xe),[[Ee,t(o).type]]),e("p",st,f(t(b).type),1)]),e("div",lt,[ot,e("div",{class:C(["w-full flex flex-row flex-wrap",t(c)?"unselectable":""])},[!t(o).warehouse||!t(o).warehouse.id?(i(),u("div",at,[e("button",{type:"button",onClick:s[1]||(s[1]=n=>z("from")),class:"flex items-center grow"},[w(r,{class:"text-2xl text-black"}),nt])])):t(o).ref_id==null?(i(),u("div",it,[e("div",ut,[e("div",ct,[rt,e("div",dt,f(t(o).warehouse.id),1)]),e("div",_t,[ft,e("div",mt,f(t(o).warehouse.name),1)])]),t(c)?m("",!0):(i(),u("button",{key:0,type:"button",class:"w-10 bg-red-600 flex items-center justify-center",onClick:s[2]||(s[2]=n=>q("from"))},[w(p,{class:"text-2xl text-white"})]))])):t(o).ref_id!=null?(i(),u("div",{key:2,class:C(["w-full flex",t(c)?"unselectable":""]),style:{}},[e("div",pt,[e("div",vt,[ht,e("div",wt,f(t(o).warehouse_source.id),1)]),e("div",xt,[yt,e("div",bt,f(t(o).warehouse_source.name),1)])]),t(c)?m("",!0):(i(),u("button",{key:0,type:"button",class:"w-10 bg-red-600 flex items-center justify-center",onClick:s[3]||(s[3]=n=>q("from"))},[w(p,{class:"text-2xl text-white"})]))],2)):m("",!0)],2),e("p",gt,f(t(b).warehouse_id),1)]),t(o).type=="transfer"?(i(),u("div",kt,[St,e("div",{class:C(["w-full flex flex-row flex-wrap",t(c)?"unselectable":""])},[!t(o).warehouse_target||!t(o).warehouse_target.id?(i(),u("div",It,[e("button",{type:"button",onClick:s[4]||(s[4]=n=>z("to")),class:"flex items-center grow"},[w(r,{class:"text-2xl text-black"}),Ct])])):(i(),u("div",Dt,[e("div",Nt,[e("div",At,[$t,e("div",jt,f(t(o).warehouse_target.id),1)]),e("div",Mt,[Tt,e("div",Bt,f(t(o).warehouse_target.name),1)])]),t(c)?m("",!0):(i(),u("button",{key:0,type:"button",class:"w-10 bg-red-600 flex items-center justify-center",onClick:s[5]||(s[5]=n=>q("to"))},[w(p,{class:"text-2xl text-white"})]))]))],2),e("p",Ot,f(t(b).warehouse_target_id),1)])):m("",!0),e("div",Rt,[qt,W(e("textarea",{disabled:t(c),class:"","onUpdate:modelValue":s[6]||(s[6]=n=>t(o).note=n)},null,8,Wt),[[G,t(o).note]]),e("p",Et,f(t(b).note),1)])]),e("div",Pt,[e("div",Vt,[e("table",Ut,[e("thead",null,[e("tr",zt,[t(c)?m("",!0):(i(),u("th",Ft,[e("button",{type:"button",name:"button",class:"bg-yellow-600",onClick:s[7]||(s[7]=n=>ie())}," Bulk Add ")])),Jt,t(c)?m("",!0):(i(),u("th",Kt)),Lt,Qt,Yt,Ht,Xt])]),e("tbody",{ref_key:"to_move",ref:J},[(i(!0),u(E,null,Pe(t(a),(n,y)=>(i(),u(E,{key:y},[n.status!="Remove"?(i(),u("tr",{key:0,"data-index":y,draggable:"true",onDragstart:_=>he(_,y),onDragover:s[8]||(s[8]=Z(()=>{},["prevent"])),onDrop:_=>we(_,y)},[t(c)?m("",!0):(i(),u("td",Zt,[e("div",es,[e("button",{type:"button",name:"button",onClick:_=>fe(_,y)},[w(k)],8,ts)])])),e("td",null,f(y+1)+".",1),t(c)?m("",!0):(i(),u("td",ss,[e("div",ls,[n.item_id?(i(),u("button",{key:1,type:"button",onClick:_=>ue(_,y),disabled:n.confirm_by},[w(I,{class:"font-bold text-2xl"})],8,as)):(i(),u("button",{key:0,type:"button",name:"button",onClick:_=>ne(_,y)}," ... ",8,os))])])),e("td",{class:C(["cell bold",t(c)?"unselectable":""])},[e("div",ns,f(n.item.id),1)],2),e("td",{class:C(["cell",t(c)?"unselectable":""])},[e("div",is,f(n.item.name),1)],2),e("td",us,[e("div",cs,[(i(),ee(h,{disabled:t(c)||t(o).type=="used"||t(o).type=="transfer",key:y,class:"w-full h-full p-1",type:"text",value:n.qty_in||0,onInput:_=>n.qty_in=_,tabindex:t(a).length*0+1},null,8,["disabled","value","onInput","tabindex"]))])]),e("td",rs,[e("div",ds,[(i(),ee(h,{disabled:t(c)||t(o).type=="in",key:y,class:"w-full h-full p-1",type:"text",value:n.qty_out||0,onInput:_=>n.qty_out=_,tabindex:t(a).length*1+1},null,8,["disabled","value","onInput","tabindex"]))])]),e("td",_s,[e("div",fs,[W(e("textarea",{disabled:t(c),class:"p-1 w-full","onUpdate:modelValue":_=>n.note=_,cols:"7",rows:"2",tabindex:t(a).length*2+1},null,8,ms),[[G,n.note]])])])],40,Gt)):m("",!0)],64))),128)),t(c)?m("",!0):(i(),u("tr",ps,[e("td",vs,[e("button",{type:"button",name:"button",onClick:s[9]||(s[9]=n=>me())},[w(x)])])]))],512)])],512)])]),e("div",hs,[e("button",{type:"button",name:"button",class:"w-36 m-1",onClick:s[10]||(s[10]=n=>l.$router.go(-1))}," Cancel "),t(c)?m("",!0):(i(),u("button",{key:0,type:"submit",name:"button",class:"w-36 m-1 bg-blue-600 text-white rounded-sm",onClick:s[11]||(s[11]=Z(n=>de(),["prevent"]))}," Save "))])])]),w(xe,{show:t(S),fnClose:le,fnSelect:oe,fnSelectMulti:ae,exclude_lists:t(g),enableMultiSelect:t(R),multi_key:["id","name"]},null,8,["show","exclude_lists","enableMultiSelect"]),w(ye,{show:t($),fnClose:ce,fnSelect:re,opt:t(j),exclude:t(_e)},null,8,["show","opt","exclude"]),w(be,{show:t(M),coor:t(F),fn:pe,data:t(a),data_index:t(d),onReplyAct:s[12]||(s[12]=n=>ve(n))},null,8,["show","coor","data","data_index"])],64)}}});export{As as default};
